# Google Sheets 데이터 연동 가이드

## 개요
이 문서는 대출 문의 양식 데이터를 Google Sheets에 자동으로 연동하는 과정에 대한 상세 가이드입니다.

## Supabase와 Google Sheets 데이터 매핑

### 컬럼 매핑 정의
Supabase의 `loanbrothers` 테이블의 데이터는 다음과 같이 Google Sheets의 열에 매핑됩니다:

| Supabase 컬럼 | Google Sheets 열 | 데이터 타입 | 설명 |
|-------------|----------------|------------|------|
| id          | A열            | 텍스트       | 고유 ID |
| age         | B열            | 숫자        | 나이 |
| phone_number | C열           | 텍스트       | 전화번호 |
| location    | D열            | 텍스트       | 지역 |
| loan_amount | E열            | 숫자        | 대출 희망 금액 |
| employed    | F열            | 텍스트       | 재직 여부 (O: 재직중, X: 미취업) |
| created_at  | G열            | 텍스트       | 등록 일시 (한국 시간) |

### Google Sheets 설정 방법

1. [Google Sheets](https://sheets.google.com/)에 접속하여 새 스프레드시트를 생성합니다.
2. 첫 번째 행에 다음과 같이 컬럼 헤더를 입력합니다:
   - A1: ID
   - B1: 나이
   - C1: 전화번호
   - D1: 지역
   - E1: 대출금액(원)
   - F1: 재직여부
   - G1: 등록일시

3. 스프레드시트 상단 메뉴에서 "형식" → "셀" → "숫자 형식" 을 선택하여 다음과 같이 설정합니다:
   - B열(나이): 숫자
   - E열(대출금액): 통화

4. 스프레드시트 URL에서 ID를 확인합니다. URL 형식은 다음과 같습니다:
   `https://docs.google.com/spreadsheets/d/{스프레드시트ID}/edit`

5. 이 ID를 환경 변수 `GOOGLE_SHEETS_ID`로 설정합니다.

## 시트 이름 변경 방법

스프레드시트의 시트 이름을 변경하고 싶은 경우:

1. Google Sheets에서 하단 탭을 마우스 오른쪽 버튼으로 클릭하고 "이름 바꾸기"를 선택합니다.
2. 원하는 시트 이름으로 변경합니다 (예: "대출문의").
3. 변경한 시트 이름을 환경 변수 `GOOGLE_SHEET_NAME`에 설정합니다.
   ```
   GOOGLE_SHEET_NAME=대출문의
   ```

## 데이터 확인 및 관리

### 자동 필터 설정
데이터 관리를 위해 필터를 설정하는 것이 좋습니다:

1. 헤더 행(1행)을 선택합니다.
2. 상단 메뉴에서 "데이터" → "필터 만들기"를 선택합니다.
3. 이제 각 컬럼 헤더의 화살표 아이콘을 클릭하여 데이터를 필터링할 수 있습니다.

### 조건부 서식 설정
중요한 데이터를 강조하기 위해 조건부 서식을 설정할 수 있습니다:

1. E열(대출금액)을 선택합니다.
2. 상단 메뉴에서 "형식" → "조건부 서식"을 선택합니다.
3. 예를 들어, 5,000만원 이상인 경우 강조하도록 설정할 수 있습니다.

## 데이터 분석 및 자동화 

### 피벗 테이블 생성
데이터 분석을 위해 피벗 테이블을 생성할 수 있습니다:

1. 데이터 영역을 선택합니다.
2. 상단 메뉴에서 "데이터" → "피벗 테이블"을 선택합니다.
3. 새 시트에 피벗 테이블이 생성됩니다.
4. 지역별 또는 재직 여부별 대출 신청 금액 등을 분석할 수 있습니다.

### Apps Script 자동화
더 복잡한 자동화가 필요한 경우 Google Apps Script를 활용할 수 있습니다:

1. 상단 메뉴에서 "확장 프로그램" → "Apps Script"를 선택합니다.
2. Apps Script 편집기가 열립니다.
3. 예를 들어, 매일 특정 시간에 요약 보고서를 이메일로 보내는 스크립트를 작성할 수 있습니다.

## 데이터 보안

Google Sheets에 저장된 데이터는 다음과 같은 방법으로 보호할 수 있습니다:

1. 스프레드시트 공유 설정을 최소화합니다 (서비스 계정만 편집 권한 부여).
2. 개인정보가 포함된 열(예: 전화번호)은 접근을 제한합니다.
3. 필요한 경우 전화번호 일부를 마스킹 처리하는 함수를 추가할 수 있습니다.

## 문제 해결

### 데이터가 Google Sheets에 추가되지 않는 경우
다음을 확인하세요:

1. 모든 환경 변수가 올바르게 설정되었는지 확인합니다.
2. 서비스 계정이 스프레드시트에 대한 편집 권한을 가지고 있는지 확인합니다.
3. Google Sheets API가 활성화되었는지 확인합니다.
4. 개발자 콘솔에서 오류 메시지를 확인합니다.

### API 할당량 문제
Google Sheets API에는 일일 요청 할당량이 있습니다. 할당량을 초과할 경우:

1. Google Cloud Console에서 할당량을 확인합니다.
2. 필요한 경우 할당량 증가를 요청합니다.
3. 대량의 요청이 예상되는 경우 일괄 처리 방식을 고려합니다. 